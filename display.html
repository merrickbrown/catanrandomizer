<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>

    <canvas id="foreground"></canvas>
    <script src="logic.js"></script>

    <script>

      var resourceColors = {'clay'   : '#BE5935', 
                            'wood'   : '#237529', 
                            'sheep'  : '#7FDF39', 
                            'wheat'  : '#e9cc2e',
                            'ore'    : '#929292',
                            'desert' : '#f8fec2'};

      var hexagon = function(X,Y,S,ctx, linecolor,linewidth, fill, fillcolor) {
        var RT3 = Math.sqrt(3);
        ctx.save();
        if (isHor) {
          ctx.translate(Y,X);
          ctx.rotate(Math.PI/6);
        } else {
          ctx.translate(X,Y);
        }

        ctx.beginPath();
        ctx.moveTo(S*RT3/2, S*1/2);
        ctx.lineTo(S*0, S*1);
        ctx.lineTo(S*(-RT3/2), S*1/2);
        ctx.lineTo(S*(-RT3/2), S*(-1/2));
        ctx.lineTo(S*0, S*(-1));
        ctx.lineTo(S*RT3/2, S*(-1/2));
        ctx.closePath();

        ctx.lineWidth = S*linewidth;
        ctx.strokeStyle = linecolor;
        ctx.stroke();

        if (fill) {
          ctx.fillStyle = fillcolor;
          ctx.fill();
        }
      
        ctx.restore();
      }

      function rollCircle(X, Y, S, ctx, number) {
        if (number != 0) {
          ctx.save();
          if (isHor) {
            ctx.translate(Y,X);
          } else {
            ctx.translate(X,Y);
          }

          ctx.beginPath();
          ctx.arc(0, 0, S, 0, 2*Math.PI);
          ctx.fillStyle = '#f8fec2'
          ctx.fill();
          // ctx.lineWidth = S*0.25
          // ctx.stroke();

          ctx.font = "bold " + S*1.3 + "px sans-serif";
          if (number === 6 || number === 8) {
            ctx.fillStyle = 'red';
          } else {
            ctx.fillStyle ='black';
          }
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(number, 0, 0);

          ctx.restore();
        }
      }
      
      var roundedHex = function(X, Y, S, radius, ctx, linecolor, linewidth, fill, fillcolor) { 
        var RT3 = Math.sqrt(3);
        var R = radius*S;
        ctx.save();
        if (isHor) {
          ctx.translate(Y,X);
          ctx.rotate(Math.PI/6);
        } else {
          ctx.translate(X,Y);
        }

        ctx.beginPath();
        ctx.moveTo(S*RT3/2, S*0);
        ctx.arcTo(S*RT3/2, S*1/2, S*0, S*1, R);
        ctx.arcTo(S*0, S*1, S*(-RT3/2), S*1/2, R);
        ctx.arcTo(S*(-RT3/2), S*1/2, S*(-RT3/2), S*(-1/2), R);
        ctx.arcTo(S*(-RT3/2), S*(-1/2), S*0, S*(-1), R);
        ctx.arcTo(S*0, S*(-1), S*RT3/2, S*(-1/2), R);
        ctx.arcTo(S*RT3/2, S*(-1/2), S*RT3/2, S*0, R);
        ctx.closePath();

        ctx.lineWidth = S*linewidth;
        ctx.strokeStyle = linecolor;
        ctx.stroke();

        if (fill) {
          ctx.fillStyle = fillcolor;
          ctx.fill();
        }
        ctx.restore();
      }

      var board = new BoardGraph(largeMap);

      var minX = arrayMin(board.vertices.map(function (v) {return v.p.x;})),
          maxX = arrayMax(board.vertices.map(function (v) {return v.p.x;})),
          minY = arrayMin(board.vertices.map(function (v) {return v.p.y;})),
          maxY = arrayMax(board.vertices.map(function (v) {return v.p.y;})),
          centerX = (minX + maxX)/2,
          centerY = (minY + maxY)/2;

      var setup = new Setup(board, largeGame);
      console.log(board.hexes.map(function(h) {return [h.center.x, h.center.y];} ));
      setup.shuffleResources();
      var rolls = setup.generate(function(s, r) {return hexFilter(noRedAdjacent, s, r);});


      (function(){
        var fcanvas = document.getElementById('foreground'),
            fcontext = fcanvas.getContext('2d');

        initialize();

        function initialize() {
          window.addEventListener('resize', resizeCanvas, false);
          resizeCanvas();
        }

        function redraw() {
          fcontext.rect(0,0, fcanvas.width, fcanvas.height);
          fcontext.fillStyle = '#66B7E4';
          fcontext.fill();

          scale = 0.9*Math.min(fcanvas.width, fcanvas.height)/Math.max(maxX - minX, maxY - minY);

          for (var i = 0; i < setup.board.hexes.length; i++) {
            roundedHex(
              scale*(setup.board.hexes[i].center.x - centerX) + (isHor ? fcanvas.height/2 : fcanvas.width/2), 
              scale*(setup.board.hexes[i].center.y - centerY) + (isHor ? fcanvas.width/2 : fcanvas.height/2), 
              scale*1.08, 
              0.25, 
              fcontext, 
              'rgb(0,0,0)', 
              0.01, 
              true, 
              'rgb(0,0,0)'
              );
          }
          for (var i = 0; i < setup.board.hexes.length; i++) {
            roundedHex(
              scale*(setup.board.hexes[i].center.x - centerX) + (isHor ? fcanvas.height/2 : fcanvas.width/2), 
              scale*(setup.board.hexes[i].center.y - centerY) + (isHor ? fcanvas.width/2 : fcanvas.height/2), 
              scale*0.92, 
              0.25, 
              fcontext, 
              resourceColors[setup.rules.resources[i]] , 
              0.01, 
              true, 
              resourceColors[setup.rules.resources[i]]);
            rollCircle(
              scale*(setup.board.hexes[i].center.x - centerX) + (isHor ? fcanvas.height/2 : fcanvas.width/2), 
              scale*(setup.board.hexes[i].center.y - centerY) + (isHor ? fcanvas.width/2 : fcanvas.height/2), 
              scale*.36, 
              fcontext, 
              rolls[i]);
          }
        }


        function resizeCanvas() {
          fcanvas.width = window.innerWidth
                          || document.documentElement.clientWidth
                          || document.body.clientWidth;

          fcanvas.height = window.innerHeight
                          || document.documentElement.clientHeight
                          || document.body.clientHeight;
          if (fcanvas.width > fcanvas.height) {
            fcanvas.width *= 2/3;
          } else {
            fcanvas.height *= 2/3;
          }
          if (fcanvas.width > fcanvas.height) {
            isHor = true;
          }
          else {isHor = false;}

          redraw();
        }
      })();
    </script>
  </body>
</html>